# ETAPA 1: Construcción (Usamos Java 21 para asegurar compatibilidad)
FROM maven:3.9.6-amazoncorretto-21 AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
# Usamos -Dmaven.test.skip=true que es más agresivo que -DskipTests
# Esto evita que intente siquiera compilar los tests
RUN mvn clean package -Dmaven.test.skip=true

# ETAPA 2: Ejecución (Usamos Java 21 también)
FROM amazoncorretto:21
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
